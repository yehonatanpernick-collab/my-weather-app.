<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TITAN v7: STABLE CORE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@500;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00ff41; /* Cyber Green */
            --alert: #ff3333;   /* Alert Red */
            --bg-dark: #050505;
            --panel: rgba(10, 15, 20, 0.95);
        }

        body {
            background-color: var(--bg-dark);
            color: var(--primary);
            font-family: 'Share Tech Mono', monospace;
            overflow: hidden;
            height: 100vh;
        }

        /* --- UI ELEMENTS --- */
        .panel-border {
            border: 1px solid rgba(0, 255, 65, 0.3);
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.1);
            position: relative;
        }
        
        /* פינות טכנולוגיות */
        .corner-decor { position: absolute; width: 10px; height: 10px; border-color: var(--primary); transition: 0.3s; }
        .tl { top: -1px; left: -1px; border-top: 2px solid; border-left: 2px solid; }
        .tr { top: -1px; right: -1px; border-top: 2px solid; border-right: 2px solid; }
        .bl { bottom: -1px; left: -1px; border-bottom: 2px solid; border-left: 2px solid; }
        .br { bottom: -1px; right: -1px; border-bottom: 2px solid; border-right: 2px solid; }

        /* אנימציות */
        .blink { animation: blinker 1s linear infinite; }
        @keyframes blinker { 50% { opacity: 0; } }

        .scanline {
            width: 100%; height: 2px; background: rgba(0, 255, 65, 0.3);
            position: absolute; z-index: 50; animation: scan 3s linear infinite; pointer-events: none;
        }
        @keyframes scan { 0% {top: 0%} 100% {top: 100%} }

        /* כוונת על הוידאו */
        .reticle {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
            background: 
                linear-gradient(to right, rgba(255,255,255,0.1) 1px, transparent 1px) 0 0 / 20% 100%,
                linear-gradient(to bottom, rgba(255,255,255,0.1) 1px, transparent 1px) 0 0 / 100% 20%;
            opacity: 0.3;
        }
        .center-cross {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 40px; height: 40px; border: 1px solid rgba(255,0,0,0.5);
        }
        .center-cross::after {
            content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 4px; height: 4px; background: red;
        }

        /* סרגל גלילה */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); }
        ::-webkit-scrollbar-track { background: #000; }

        .btn-action {
            background: rgba(0, 255, 65, 0.1); border: 1px solid var(--primary);
            color: var(--primary); padding: 5px 15px; cursor: pointer; text-transform: uppercase;
            font-size: 10px; transition: 0.2s;
        }
        .btn-action:hover { background: var(--primary); color: black; }
    </style>
</head>
<body class="flex flex-col lg:flex-row h-screen">

    <aside class="w-full lg:w-80 bg-black border-l border-green-900 flex flex-col z-20">
        <div class="p-4 border-b border-green-800">
            <h1 class="text-3xl font-['Orbitron'] font-bold tracking-widest text-white">TITAN <span class="text-green-500">v7</span></h1>
            <div class="text-[10px] text-green-600 mt-1 flex justify-between">
                <span>SYS: ONLINE</span>
                <span>SEC: ENCRYPTED</span>
            </div>
        </div>

        <div class="p-2 grid grid-cols-2 gap-2">
            <button onclick="toggleFullscreen()" class="btn-action text-center"><i class="fas fa-expand"></i> FULL SCR</button>
            <button onclick="forceReload()" class="btn-action text-center text-red-400 border-red-400 hover:bg-red-500"><i class="fas fa-sync"></i> REBOOT</button>
        </div>

        <div id="feedList" class="flex-1 overflow-y-auto p-2 space-y-2">
            </div>

        <div class="h-24 bg-black border-t border-green-800 p-2 relative overflow-hidden">
            <div class="text-[9px] text-green-600 mb-1">NETWORK LATENCY</div>
            <div id="graph-container" class="flex items-end h-12 gap-1">
                </div>
        </div>
    </aside>

    <main class="flex-1 relative flex flex-col bg-[#020202]">
        
        <div class="absolute top-0 left-0 w-full p-4 z-20 flex justify-between items-start pointer-events-none">
            <div class="bg-black/80 p-2 border border-green-500/30 backdrop-blur-sm">
                <div class="text-[10px] text-gray-400">TARGET DESIGNATION</div>
                <div id="targetName" class="text-xl font-bold text-white font-['Orbitron']">INITIALIZING...</div>
                <div id="geoCoords" class="text-xs text-green-400 font-mono mt-1">LAT: --.-- | LON: --.--</div>
            </div>
            
            <div class="flex flex-col items-end gap-2">
                <div class="bg-red-900/20 border border-red-500 text-red-500 px-3 py-1 text-xs font-bold blink backdrop-blur-sm">
                    ● LIVE RECORDING
                </div>
                <div class="text-3xl font-bold text-white font-mono" id="mainClock">00:00:00</div>
            </div>
        </div>

        <div class="relative flex-1 bg-black flex items-center justify-center overflow-hidden">
            <div class="scanline"></div>
            <div class="reticle">
                <div class="center-cross"></div>
            </div>
            
            <iframe id="videoPlayer" class="w-full h-full absolute inset-0 object-cover" 
                    src="" frameborder="0" allow="autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen>
            </iframe>

            <div id="fallbackMsg" class="hidden absolute z-0 text-center">
                <i class="fas fa-exclamation-triangle text-4xl text-yellow-500 mb-2"></i>
                <div class="text-white">SIGNAL LOST</div>
                <button onclick="forceReload()" class="mt-2 text-xs border border-white px-2 py-1 text-white hover:bg-white hover:text-black">TRY RECONNECT</button>
            </div>
        </div>

        <div class="h-40 lg:h-48 bg-black border-t border-green-800 p-4 grid grid-cols-2 lg:grid-cols-4 gap-4 z-20">
            
            <div class="panel-border p-3 bg-gray-900/50">
                <div class="corner-decor tl"></div><div class="corner-decor tr"></div><div class="corner-decor bl"></div><div class="corner-decor br"></div>
                <div class="text-[10px] text-green-600 mb-2">ATMOSPHERIC DATA</div>
                <div class="flex justify-between items-end">
                    <div class="text-3xl text-white font-bold"><span id="temp">--</span>°C</div>
                    <div class="text-sm text-green-400 mb-1"><i class="fas fa-wind"></i> <span id="wind">--</span> km/h</div>
                </div>
                <div class="text-xs text-gray-400 mt-1" id="condition">Scanning...</div>
            </div>

            <div class="col-span-1 lg:col-span-2 panel-border p-2 bg-black font-mono text-[10px] overflow-hidden flex flex-col relative">
                <div class="text-green-800 border-b border-green-900 mb-1">SYSTEM_LOG</div>
                <div id="terminal" class="flex-1 overflow-hidden text-green-400 flex flex-col justify-end"></div>
            </div>

            <div class="panel-border p-3 bg-gray-900/50 flex flex-col justify-center items-center">
                <div class="corner-decor tl"></div><div class="corner-decor br"></div>
                <div class="text-[10px] text-green-600 mb-1">THREAT ANALYSIS</div>
                <div id="threatLevel" class="text-2xl font-bold text-blue-400">SAFE</div>
                <div class="w-full bg-gray-800 h-1 mt-2 rounded">
                    <div id="threatBar" class="h-full bg-blue-500 w-[20%] transition-all duration-1000"></div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // --- SECURE FEED DATABASE (Updated Links) ---
        // אם לינק לא עובד, רק צריך להחליף את ה-ID כאן
        const feeds = [
            { id: "xRPjKQtRKT8", name: "NASA ISS", loc: "LOW EARTH ORBIT", lat: 0, lon: 0 },
            { id: "2jR3E3n_3yY", name: "TOKYO", loc: "SHIBUYA CROSSING", lat: 35.6595, lon: 139.7004 },
            { id: "mPZ73C8yR24", name: "NEW YORK", loc: "TIMES SQUARE", lat: 40.7580, lon: -73.9855 },
            { id: "91I8pZAQE30", name: "LONDON", loc: "TOWER BRIDGE", lat: 51.5055, lon: -0.0754 }, // Updated London
            { id: "MIt3jFiHbTs", name: "JERUSALEM", loc: "WESTERN WALL", lat: 31.7767, lon: 35.2345 },
            { id: "Kz38S45k-d0", name: "ROME", loc: "COLOSSEUM", lat: 41.8902, lon: 12.4922 },
            { id: "O8xIXy1wH9o", name: "KENYA", loc: "WILDLIFE CAM", lat: -1.2921, lon: 36.8219 }
        ];

        let activeFeed = null;

        // --- INIT ---
        window.onload = () => {
            renderList();
            startClock();
            simulateGraph();
            loadFeed(0); // Load first cam
            log("SYSTEM INITIALIZED");
            log("CONNECTED TO SATELLITE RELAY");
        };

        // --- CORE FUNCTIONS ---
        function renderList() {
            const container = document.getElementById('feedList');
            feeds.forEach((feed, index) => {
                const el = document.createElement('div');
                el.className = "panel-border p-3 cursor-pointer hover:bg-green-900/30 transition flex justify-between items-center group";
                el.onclick = () => loadFeed(index);
                el.innerHTML = `
                    <div>
                        <div class="font-bold text-white text-sm group-hover:text-green-400">${feed.name}</div>
                        <div class="text-[9px] text-gray-500">${feed.loc}</div>
                    </div>
                    <i class="fas fa-satellite-dish text-[10px] text-gray-700 group-hover:text-green-500"></i>
                `;
                container.appendChild(el);
            });
        }

        function loadFeed(index) {
            activeFeed = feeds[index];
            
            // 1. Update Header
            document.getElementById('targetName').innerText = activeFeed.name;
            document.getElementById('geoCoords').innerText = `LAT: ${activeFeed.lat.toFixed(4)} | LON: ${activeFeed.lon.toFixed(4)}`;
            
            // 2. Load Video (with error handling visually)
            const iframe = document.getElementById('videoPlayer');
            // שימוש בפרמטרים אגרסיביים לטעינה מהירה
            iframe.src = `https://www.youtube.com/embed/${activeFeed.id}?autoplay=1&mute=1&controls=0&showinfo=0&rel=0&modestbranding=1&playsinline=1`;
            
            // 3. Reset Fallback
            document.getElementById('fallbackMsg').classList.add('hidden');
            
            // 4. Logs & Data
            log(`ESTABLISHING LINK: ${activeFeed.name}`);
            fetchWeather(activeFeed);
            analyzeThreat(activeFeed);
        }

        function forceReload() {
            log("MANUAL REBOOT INITIATED...");
            const iframe = document.getElementById('videoPlayer');
            const currentSrc = iframe.src;
            iframe.src = ''; 
            setTimeout(() => {
                iframe.src = currentSrc;
                log("SIGNAL RESTORED");
            }, 500);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // --- DATA SIMULATION ---
        async function fetchWeather(feed) {
            if(feed.lat === 0) { // Space
                updateWeatherUI("-270", "0", "VACUUM");
                return;
            }
            
            updateWeatherUI("--", "--", "Syncing...");
            
            try {
                const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${feed.lat}&longitude=${feed.lon}&current=temperature_2m,wind_speed_10m,weather_code`);
                const data = await res.json();
                
                const weatherCode = data.current.weather_code;
                let condition = "CLEAR";
                if(weatherCode > 3) condition = "CLOUDY";
                if(weatherCode > 50) condition = "RAIN";
                if(weatherCode > 71) condition = "SNOW";

                updateWeatherUI(
                    Math.round(data.current.temperature_2m),
                    data.current.wind_speed_10m,
                    condition
                );
            } catch(e) {
                log("METEO DATA PACKET LOSS");
            }
        }

        function updateWeatherUI(t, w, c) {
            document.getElementById('temp').innerText = t;
            document.getElementById('wind').innerText = w;
            document.getElementById('condition').innerText = c;
        }

        function analyzeThreat(feed) {
            // סימולציה של ניתוח איומים לפי מיקום
            const threatEl = document.getElementById('threatLevel');
            const bar = document.getElementById('threatBar');
            
            let level = "SAFE";
            let color = "text-blue-400";
            let width = "20%";
            let barColor = "bg-blue-500";

            if(feed.lat === 0) { // Space is dangerous
                level = "HAZARD"; color = "text-orange-500"; width = "80%"; barColor = "bg-orange-500";
            } else if (Math.random() > 0.7) {
                level = "CAUTION"; color = "text-yellow-400"; width = "50%"; barColor = "bg-yellow-500";
            }

            threatEl.innerText = level;
